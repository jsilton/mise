---
// RecipeCard.astro - Reusable recipe card component for grid display
// Encapsulates all card styling, tags, and data attributes

import TagBadge from './TagBadge.astro';

interface Recipe {
  slug: string;
  data: {
    title: string;
    difficulty?: string;
    cuisines?: string[];
    dietary?: string[];
    cookingMethods?: string[];
    occasions?: string[];
    flavorProfile?: string[];
    prepTime?: string;
    cookTime?: string;
    ingredients?: string[];
  };
}

interface Props {
  recipe: Recipe;
  baseUrl?: string;
}

const { recipe, baseUrl = import.meta.env.BASE_URL } = Astro.props;

// Extract primary dietary tag (prioritize vegetarian/vegan)
const primaryDietaryTag =
  recipe.data.dietary?.find((d) => d === 'vegetarian' || d === 'vegan') || recipe.data.dietary?.[0];
---

<a
  href={`${baseUrl}recipes/${recipe.slug}`}
  class="recipe-card group bg-white rounded-xl border border-slate-200/80 hover:border-indigo-300 shadow-soft hover:shadow-soft-lg transition-all duration-200 overflow-hidden flex flex-col h-full"
  data-difficulty={recipe.data.difficulty}
  data-cuisines={recipe.data.cuisines?.join(',')}
  data-dietary={recipe.data.dietary?.join(',')}
  data-cooking-methods={recipe.data.cookingMethods?.join(',')}
  data-occasions={recipe.data.occasions?.join(',')}
  data-flavor-profile={recipe.data.flavorProfile?.join(',')}
  data-prep-time={recipe.data.prepTime}
>
  <div class="p-4 flex flex-col h-full">
    <h2
      class="text-sm font-semibold text-slate-800 group-hover:text-indigo-600 line-clamp-2 mb-2.5 leading-snug tracking-tight"
    >
      {recipe.data.title}
    </h2>

    <!-- Key Tags -->
    <div class="flex flex-wrap gap-1.5 mb-3">
      {
        recipe.data.cuisines?.[0] && (
          <TagBadge tag={recipe.data.cuisines[0]} category="cuisine" size="sm" />
        )
      }
      {
        recipe.data.difficulty && (
          <TagBadge tag={recipe.data.difficulty} category="difficulty" size="sm" />
        )
      }
      {primaryDietaryTag && <TagBadge tag={primaryDietaryTag} category="dietary" size="sm" />}
    </div>

    <!-- Time metadata -->
    <div
      class="mt-auto pt-3 border-t border-slate-100/80 flex items-center justify-between text-2xs text-slate-400 font-medium"
    >
      <div class="flex items-center gap-2">
        {recipe.data.prepTime && <span>{recipe.data.prepTime}</span>}
        {
          recipe.data.cookTime && (
            <span class="flex items-center gap-1 before:content-['Â·'] before:mr-1 before:text-slate-300">
              {recipe.data.cookTime} cook
            </span>
          )
        }
      </div>
    </div>
  </div>

  <!-- Hidden search data for filtering -->
  <div class="hidden search-data">
    {recipe.data.title.toLowerCase()}
    {recipe.data.ingredients?.join(' ').toLowerCase()}
  </div>
</a>
